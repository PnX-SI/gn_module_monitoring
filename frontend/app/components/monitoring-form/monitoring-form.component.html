<pnx-modal-msg [bDisplayModal]="bDeleteModal" *ngIf="obj && obj.bIsInitialized">
  <h2>Attention</h2>
  <p>
    Vous êtes sur le point de supprimer l'élément
    {{ this.obj.template["label"] }}
    {{ this.obj.template["description"] }}
  </p>
  <button class="btn btn-danger float-right" (click)="onDelete()">
    <span
      [ngClass]="{ 'hide-spinner': !bDeleteSpinner }"
      class="spinner-border spinner-border-sm"
      role="status"
      aria-hidden="true"
    ></span>
    Confirmer la suppression
  </button>
  <button class="btn btn-primary" (click)="bDeleteModal = false">
    Annuler
  </button>
</pnx-modal-msg>

<div>
  <div
    id="properties-form"
    class="cadre"
    *ngIf="obj.bIsInitialized && objFormsDefinition"
  >
    <h3>
      {{ obj.id ? "Modification" : "Création" }}<span
        *ngIf="!obj.id"
        id="toggle-btn"
        class="float-right"
        matTooltip="Enchainer les saisies"
        matTooltipPosition="left"
      >
        <i class="fa fa-repeat" aria-hidden="true"></i>
        <mat-slide-toggle
          color="primary"
          [(ngModel)]="bChainInput"
          (change)="bChainInputChanged($event)"
        >
        </mat-slide-toggle>
      </span>
    </h3>
    <div *ngIf="obj.configParam('keep') && bChainInput && objFormsDefinition">
      <mat-form-field>
        <mat-label>Garder les valeurs</mat-label>
        <!-- [formControl]="toppings" -->
        <mat-select [(ngModel)]="keepNames" multiple>
          <mat-option
            *ngFor="let formDef of keepDefinitions()"
            [value]="formDef.attribut_name"
            >{{ formDef.attribut_label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <hr />
    </div>

    <form [formGroup]="objForm">
      <p class="alert alert-danger" *ngIf="obj.config['geometry_type'] && !objForm.value.geometry">
        <span class="material-icons">
          warning
          </span>
          <span>
            Veuillez saisir une géométrie sur la carte
          </span>
      </p>

      <!-- composant choix de site select + filtre -->
      <pnx-monitoring-choix-site
        *ngIf="testChoixSite()"
        [sites]="sites"
        [objForm]="objForm"
        [(searchSite)]="searchSite"
      ></pnx-monitoring-choix-site>

      <!--pnx-monitoring-choix-aire
        *ngIf="testChoixAire()"
        [aires]="aires"
        [objForm]="objForm"
        [(searchAire)]="searchAire">
      </pnx-monitoring-choix-aire-->

      <pnx-dynamic-form-generator
        class="obj-form"
        #dynamicForm
        [autoGenerated]="true"
        [myFormGroup]="objForm"
        [formsDefinition]="objFormsDefinition"
      ></pnx-dynamic-form-generator>

      <div>

        <button
        *ngIf="!bChainInput && !obj.id && obj.uniqueChildrenName()"
        class="btn btn-success float-right"
        (click)="bAddChildren=true; onSubmit();"
        [disabled]="!objForm.valid"
      >
        <span
          [ngClass]="{ 'hide-spinner': !bSaveSpinner }"
          class="spinner-border spinner-border-sm float-right"
          role="status"
          aria-hidden="true"
        ></span>

        <span
          >Valider et saisir des {{obj.uniqueChildrenName()}}</span
        >
      </button>


        <button
          class="btn btn-success float-right"
          (click)="onSubmit()"
          [disabled]="!objForm.valid"
        >
          <span
            [ngClass]="{ 'hide-spinner': !bSaveSpinner }"
            class="spinner-border spinner-border-sm float-right"
            role="status"
            aria-hidden="true"
          ></span>

          <span *ngIf="bChainInput && !obj.id"
            >Valider et enchainer les saisies</span>
          <span *ngIf="!bChainInput || obj.id">Valider</span>
        </button>

        <button class="btn btn-primary float-left" (click)="onCancelEdit()">
          Annuler
        </button>
        <button
          class="btn btn-danger float-left"
          (click)="bDeleteModal = true"
          *ngIf="obj.id && currentUser?.cruved.D >= 1"
        >
          Supprimer
        </button>
      </div>
      <div class="btn-height"></div>
    </form>
  </div>
</div>
