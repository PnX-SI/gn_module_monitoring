<pnx-modal-msg [bDisplayModal]="bDeleteModal" *ngIf="obj && obj.bIsInitialized">
  <h2>Attention</h2>
  <p *ngIf="obj.config && obj.properties">
    <!-- TODO: voir pour améliorer le passage d'informations ici -->
    Vous êtes sur le point de supprimer {{obj.config["label"]}} :
    {{obj.properties[obj.config["description_field_name"]]}}
    <br /><b>(id :{{obj.properties[obj.config["id_field_name"]]}})</b>
  </p>
  <button class="btn btn-danger float-right" (click)="onDelete()">
    <span
      [ngClass]="{ 'hide-spinner': !bDeleteSpinner }"
      class="spinner-border spinner-border-sm"
      role="status"
      aria-hidden="true"
    ></span>
    Confirmer la suppression
  </button>
  <button class="btn btn-primary" (click)="bDeleteModal = false">Annuler</button>
</pnx-modal-msg>

<div>
  <div
    id="properties-form"
    class="cadre"
    *ngIf="obj && obj.bIsInitialized && (objFormsDefinition?.static || objFormsDefinition?.dynamic)"
  >
    <!-- TODO: voir pour intiialisation si nécessaire à remettre dans la div du dessus -->
    <!-- *ngIf="obj.bIsInitialized && objFormsDefinition" -->

    <!--  TODO: Voir pour l'enchainement des saisies -->
    <span
      *ngIf="!obj.id && obj.config['chained']"
      id="toggle-btn"
      class="float-right"
      matTooltip="Enchainer les saisies"
      matTooltipPosition="left"
    >
      <i class="fa fa-repeat" aria-hidden="true"></i>
      <mat-slide-toggle
        color="primary"
        [(ngModel)]="bChainInput"
        (change)="bChainInputChanged($event)"
      >
      </mat-slide-toggle>
    </span>

    <ng-container *ngIf="objForm && objForm.static">
      <form [formGroup]="objForm.static">
        <!-- TODO: Gérer la saisie de géometrie -->
        <p
          class="alert alert-warning"
          style="display: inline-block; padding: 4px"
          *ngIf="obj.config && obj.config['geometry_type'] && !objForm.static.value.geometry"
        >
          <span> Veuillez saisir une géométrie sur la carte </span>
        </p>
        <!-- composant choix de site select + filtre -->

        <div
          [ngClass]="{
          'form-scroll-info-geom':obj.config && obj.config['geometry_type'] && !objForm.static.value.geometry  ,
          'form-scroll': !(obj.config && obj.config['geometry_type'] && !objForm.static.value.geometry)}"
        >
          <ng-container *ngIf="objForm.static">
            <pnx-dynamic-form-generator
              class="obj-form"
              #dynamicForm
              [autoGenerated]="true"
              [myFormGroup]="objForm.static"
              [formsDefinition]="objFormsDefinition.static"
              (myFormGroupChange)="initForm()"
              (change)="onObjFormValueChange($event)"
            ></pnx-dynamic-form-generator>
          </ng-container>
          <ng-content add-select></ng-content>
          <ng-container *ngIf="objForm && objForm.dynamic">
            <span
              class="alert alert-warning"
              style="display: inline-block; padding: 2px"
              *ngIf="obj.objectType.includes('site')"
            >
              <mat-icon>error</mat-icon> La suppression de types de site entraine la
              réinitialisation des champs associés
            </span>

            <pnx-dynamic-form-generator
              class="obj-form"
              #dynamicForm
              [autoGenerated]="true"
              [myFormGroup]="objForm.dynamic"
              [formsDefinition]="objFormsDefinition.dynamic"
              (myFormGroupChange)="initValueFormDynamic()"
              (change)="onObjFormDynamicValueChange($event)"
            ></pnx-dynamic-form-generator>
          </ng-container>
        </div>
        <!--TODO: add class when text-overflow https://www.taithienbo.com/displaying-text-in-a-tool-tip-when-text-overflows-its-container/ -->
        <div class="btn-child">
          <!-- <button
          *ngIf="!bChainInput && !obj.id && obj.uniqueChildrenName()"
          class="btn btn-success float-right"
          (click)="bSaveAndAddChildrenSpinner = bAddChildren = true; onSubmit()"
          [disabled]="!objForm.valid"
        >
          <span
            [ngClass]="{ 'hide-spinner': !bSaveAndAddChildrenSpinner }"
            class="spinner-border spinner-border-sm float-right"
            role="status"
            aria-hidden="true"
          ></span>

          <span
            >Valider et saisir des {{obj.uniqueChildrenName()}}</span
          >
        </button> -->

          <button
            mat-raised-button
            color="primary"
            class="float-right"
            (click)="canCreateOrUpdate ? onSubmit() : notAllowedMessage()"
            [disabled]="isExtraForm ? (objForm.dynamic.status == 'INVALID' || extraFormCtrl?.frmCtrl.status == 'INVALID' || objForm.static.status == 'INVALID') : objForm.static.status == 'INVALID'  "
          >
            <span
              [ngClass]="{ 'hide-spinner': !bSaveSpinner }"
              class="spinner-border spinner-border-sm float-right"
              role="status"
              aria-hidden="true"
            ></span>

            <span *ngIf="bChainInput && !obj.id">Valider et enchainer les saisies</span>
            <span *ngIf="!bChainInput || obj.id">Valider</span>
          </button>

          <!-- <span>Valider</span>
        </button> -->

          <button mat-raised-button color="warn" class="float-left" (click)="onCancelEdit()">
            Annuler
          </button>
          <button
          mat-raised-button
          [matTooltip]="canDelete ? null : toolTipNotAllowed"
          [disabled]="!canDelete"
          color="warn"
          class="float-left"
          (click)="canDelete ? bDeleteModal = true : null"
            *ngIf="obj.id"
          >
            Supprimer
          </button>
        </div>
        <div class="btn-height"></div>
      </form>
    </ng-container>
  </div>
</div>
